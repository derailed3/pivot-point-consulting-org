name: Validate Documentation

on:
  pull_request:
    paths: ["**.md"]
  push:
    branches: [main]
    paths: ["**.md"]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Markdown Lint
        uses: DavidAnson/markdownlint-cli2-action@v16
        with:
          globs: "**/*.md"
          config: ".markdownlint.json"

      - name: Check Links
        uses: lycheeverse/lychee-action@v1
        with:
          args: --verbose --no-progress "**/*.md"
          fail: true

      - name: Validate Frontmatter
        run: |
          echo "Checking for YAML frontmatter in all .md files..."
          errors=0
          while IFS= read -r file; do
            if [[ "$file" == *"_archive"* ]] || [[ "$file" == *"node_modules"* ]]; then
              continue
            fi
            first_line=$(head -n 1 "$file")
            if [ "$first_line" != "---" ]; then
              echo "ERROR: Missing YAML frontmatter in $file"
              errors=$((errors + 1))
            fi
          done < <(find . -name "*.md" -not -path "./.git/*" -not -path "./node_modules/*" -not -path "./site/*")
          if [ $errors -gt 0 ]; then
            echo "Found $errors files missing YAML frontmatter"
            exit 1
          fi
          echo "All files have YAML frontmatter"

      - name: Check Trailing Whitespace
        run: |
          if grep -rn ' $' --include="*.md" .; then
            echo "ERROR: Trailing whitespace found"
            exit 1
          fi
          echo "No trailing whitespace found"
